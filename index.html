<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Clock</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #current-time { font-size: 72px; font-weight: bold; color: #333; margin: 20px 0; }
        #timezone { font-size: 28px; color: #666; }
        .countdown { font-size: 48px; color: red; font-weight: bold; margin-top: 20px; }
        .inputs { margin: 30px 0; }
        input { font-size: 20px; padding: 12px; width: 220px; margin: 8px; border: 2px solid #ddd; }
        label { display: block; font-size: 18px; font-weight: bold; }
        .milestones { background: #f8f9fa; padding: 25px; border-radius: 15px; max-width: 700px; margin: 25px auto; }
        .milestone { font-size: 24px; margin: 15px 0; font-weight: 500; }
    </style>
</head>
<body>
    <h1>Exam Countdown Clock</h1>
    <div id="current-time">Loading...</div>
    <div id="timezone"></div>

    <div class="inputs">
        <label>Exam Start (Auckland, YYYY-MM-DD HH:MM):</label>
        <input type="text" id="start-input" placeholder="2026-02-20 09:30" value="2026-02-20 09:30">
        <br>
        <label>Reading Time (minutes):</label>
        <input type="number" id="reading-min" value="10" min="0">
        <label>Total Exam Duration (minutes):</label>
        <input type="number" id="exam-min" value="180" min="1">
    </div>

    <div class="milestones">
        <div class="milestone" id="start-time">Start: --</div>
        <div class="milestone" id="reading-end">Reading Ends: --</div>
        <div class="milestone" id="halfway">Halfway: --</div>
        <div class="milestone" id="warn-15">15min Warning: --</div>
        <div class="milestone" id="end-time">End: --</div>
        <div class="countdown" id="countdown">Enter start time above</div>
    </div>

    <script>
        const aucklandTz = 'Pacific/Auckland';

        function parseAucklandLocal(dateStr) {
            // Parse "2026-02-20 09:30" as Auckland local time
            const [datePart, timePart] = dateStr.trim().split(' ');
            const [year, month, day] = datePart.split('-').map(Number);
            const [hour, minute] = timePart.split(':').map(Number);
            
            // Create date in Auckland timezone
            const aklDate = new Date(year, month - 1, day, hour, minute);
            return aklDate;
        }

        function formatAucklandTime(date) {
            return new Intl.DateTimeFormat('en-NZ', {
                timeZone: aucklandTz,
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit', 
                minute: '2-digit', 
                hour12: false
            }).format(date);
        }

        function updateMilestones() {
            const startInput = document.getElementById('start-input').value;
            if (!startInput) return;

            try {
                const readingMin = parseInt(document.getElementById('reading-min').value) || 0;
                const examMin = parseInt(document.getElementById('exam-min').value) || 180;

                const startAkl = parseAucklandLocal(startInput);
                const startUtc = new Date(startAkl.toLocaleString("en-US", {timeZone: aucklandTz}));

                const readingEndUtc = new Date(startUtc.getTime() + readingMin * 60 * 1000);
                const halfwayUtc = new Date(startUtc.getTime() + (readingMin + (examMin - readingMin) / 2) * 60 * 1000);
                const warn15Utc = new Date(startUtc.getTime() + (readingMin + examMin - 15) * 60 * 1000);
                const endUtc = new Date(startUtc.getTime() + (readingMin + examMin) * 60 * 1000);

                document.getElementById('start-time').textContent = `Start: ${formatAucklandTime(startUtc)}`;
                document.getElementById('reading-end').textContent = `Reading Ends: ${formatAucklandTime(readingEndUtc)}`;
                document.getElementById('halfway').textContent = `Halfway: ${formatAucklandTime(halfwayUtc)}`;
                document.getElementById('warn-15').textContent = `15min Warning: ${formatAucklandTime(warn15Utc)}`;
                document.getElementById('end-time').textContent = `End: ${formatAucklandTime(endUtc)}`;
            } catch (e) {
                document.getElementById('countdown').textContent = 'Invalid date format';
            }
        }

        function updateClock() {
            const now = new Date();
            const currentTime = new Intl.DateTimeFormat('en-NZ', {
                timeZone: aucklandTz,
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
            }).format(now);
            
            document.getElementById('current-time').textContent = currentTime;
            document.getElementById('timezone').textContent = 'Pacific/Auckland (NZDT)';

            // Countdown to END time
            const endDiv = document.getElementById('end-time').textContent;
            if (endDiv !== 'End: --') {
                try {
                    const endAkl = parseAucklandLocal(endDiv.replace('End: ', '').split(' ')[0] + ' ' + endDiv.match(/(\d{2}:\d{2})/)[1]);
                    const endUtc = new Date(endAkl.toLocaleString("en-US", {timeZone: aucklandTz}));
                    const diff = endUtc - now;

                    if (diff > 0) {
                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                        
                        document.getElementById('countdown').textContent = 
                            `${days}d ${hours.toString().padStart(2,'0')}h ${minutes.toString().padStart(2,'0')}m ${seconds.toString().padStart(2,'0')}s`;
                        return;
                    }
                } catch (e) {}
            }
            document.getElementById('countdown').textContent = 'Enter valid start time';
        }

        // Event listeners
        document.getElementById('start-input').addEventListener('input', updateMilestones);
        document.getElementById('reading-min').addEventListener('input', updateMilestones);
        document.getElementById('exam-min').addEventListener('input', updateMilestones);

        // Initialize
        updateMilestones();
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>
