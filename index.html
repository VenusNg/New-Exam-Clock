<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Clock</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #clock { font-size: 48px; }
        #timezone { font-size: 24px; }
        .countdown { font-size: 32px; color: red; }
        .inputs { margin: 20px 0; }
        input { font-size: 18px; padding: 10px; width: 200px; margin: 5px; }
        label { display: block; font-size: 16px; }
        .milestones { background: #f0f0f0; padding: 20px; border-radius: 10px; max-width: 600px; margin: 20px auto; }
        .milestone { font-size: 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Exam Countdown Clock</h1>
    <div id="current-time"></div>
    <div id="timezone"></div>

    <div class="inputs">
        <label>Enter Exam Start Time (Auckland, YYYY-MM-DD HH:MM):</label>
        <input type="text" id="start-input" placeholder="2026-02-20 09:30" value="2026-02-20 09:30">
        <br>
        <label>Reading Time (minutes):</label>
        <input type="number" id="reading-min" value="10" min="0">
        <label>Total Exam Duration (minutes):</label>
        <input type="number" id="exam-min" value="180" min="1">
    </div>

    <div class="milestones">
        <div class="milestone" id="start-time">Start: --</div>
        <div class="milestone" id="reading-end">Reading Ends: --</div>
        <div class="milestone" id="halfway">Halfway: --</div>
        <div class="milestone" id="warn-15">15min Warning: --</div>
        <div class="milestone" id="end-time">End: --</div>
        <div class="countdown" id="countdown">Enter start time above</div>
    </div>

    <script>
        const aucklandTz = 'Pacific/Auckland';

        function parseAucklandDate(dateStr) {
            const [datePart, timePart] = dateStr.trim().split(' ');
            const [year, month, day] = datePart.split('-').map(Number);
            const [hour, minute] = timePart.split(':').map(Number);
            const dt = new Date(Date.UTC(year, month-1, day, hour, minute));
            return new Intl.DateTimeFormat('en-NZ', {
                timeZone: aucklandTz,
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit', hour12: false
            }).format(dt);
        }

        function updateMilestones() {
            const startInput = document.getElementById('start-input').value;
            if (!startInput) return;

            const readingMin = parseInt(document.getElementById('reading-min').value) || 0;
            const examMin = parseInt(document.getElementById('exam-min').value) || 180;

            // Parse start as Auckland local, convert to UTC for calculations
            const startLocalStr = `${startInput}:00`;
            const startAkl = new Date(startLocalStr + ' GMT+1300'); // Approximate parse for NZDT
            const startUtc = new Date(startAkl.toISOString());

            const readingEndUtc = new Date(startUtc.getTime() + readingMin * 60 * 1000);
            const halfwayUtc = new Date(startUtc.getTime() + (readingMin + (examMin - readingMin)/2) * 60 * 1000);
            const warn15Utc = new Date(startUtc.getTime() + (readingMin + examMin - 15) * 60 * 1000);
            const endUtc = new Date(startUtc.getTime() + (readingMin + examMin) * 60 * 1000);

            // Display all in Auckland format
            const formatAkl = (utcDate) => new Intl.DateTimeFormat('en-NZ', {
                timeZone: aucklandTz,
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit', hour12: false
            }).format(utcDate);

            document.getElementById('start-time').textContent = `Start: ${formatAkl(startUtc)}`;
            document.getElementById('reading-end').textContent = `Reading Ends: ${formatAkl(readingEndUtc)}`;
            document.getElementById('halfway').textContent = `Halfway: ${formatAkl(halfwayUtc)}`;
            document.getElementById('warn-15').textContent = `15min Warning: ${formatAkl(warn15Utc)}`;
            document.getElementById('end-time').textContent = `End: ${formatAkl(endUtc)}`;
        }

        function updateClock() {
            const now = new Date();
            const options = {
                timeZone: aucklandTz,
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
            };
            const currentTime = new Intl.DateTimeFormat('en-NZ', options).format(now);
            document.getElementById('current-time').textContent = `Auckland Time: ${currentTime}`;
            document.getElementById('timezone').textContent = 'Pacific/Auckland (NZDT)';

            // Update countdown to next milestone (End time)
            const endDiv = document.getElementById('end-time').textContent;
            if (endDiv.includes('End:')) {
                const endMatch = endDiv.match(/(\d{4}-\d{2}-\d{2} \d{2}:\d{2})/);
                if (endMatch) {
                    const endLocalStr = endMatch[1] + ':00';
                    const endAkl = new Date(endLocalStr + ' GMT+1300');
                    const endUtc = new Date(endAkl.toISOString());
                    const diff = endUtc - now;
                    if (diff > 0) {
                        const days = Math.floor(diff / (1000*60*60*24));
                        const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
                        const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
                        const secs = Math.floor((diff % (1000*60)) / 1000);
                        document.getElementById('countdown').textContent = `To End: ${days}d ${hours}h ${mins}m ${secs}s`;
                        return;
                    }
                }
            }
            document.getElementById('countdown').textContent = 'Exam complete!';
        }

        // Event listeners for inputs
        document.getElementById('start-input').addEventListener('input', updateMilestones);
        document.getElementById('reading-min').addEventListener('input', updateMilestones);
        document.getElementById('exam-min').addEventListener('input', updateMilestones);

        // Initial setup
        updateMilestones();
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>

